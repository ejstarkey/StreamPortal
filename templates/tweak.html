<!-- templates/tweak.html -->
{% extends "base.html" %}

{% block content %}
<!-- Button to open RTMP Tweak Modal -->
<button id="tweak-popup-btn" class="btn btn-secondary" style="margin: 10px;">
    ðŸ”§ RTMP Tweak Settings
</button>

<div id="tweak-modal" class="modal">
  <div class="modal-content">
    <span id="close-tweak-modal" class="modal-close">&times;</span>
    <h3 class="text-xl font-semibold mb-4">ðŸ”§ RTMP Tweak: Global Streaming Settings</h3>
    
    <!-- GPU Monitoring Section -->
    <div class="gpu-monitor-section">
        <h4>ðŸŽ® GPU Status & Performance</h4>
        <div id="gpu-status" class="gpu-status">
            <div class="gpu-loading">Loading GPU information...</div>
        </div>
        <button id="refresh-gpu" class="refresh-btn">ðŸ”„ Refresh GPU Data</button>
    </div>

    <form id="tweak-form">
      <div class="form-group">
        <label for="encoder">Encoder</label>
        <select id="encoder" name="encoder">
          <option value="obs_x264">x264 (CPU)</option>
          <option value="obs_nvenc">NVENC (NVIDIA GPU)</option>
        </select>
        <p class="form-help">Choose encoding hardware. Use NVENC when GPU is available.</p>
      </div>

      <div class="form-group">
        <label for="bitrate">Bitrate (kbps)</label>
        <input type="number" id="bitrate" name="bitrate" min="1000" max="20000" step="100" value="6000">
        <p class="form-help">Controls stream quality. Recommended: 6000 for 1080p.</p>
      </div>

      <div class="form-group">
        <label for="rate_control">Rate Control</label>
        <select id="rate_control" name="rate_control">
          <option value="CBR">CBR</option>
          <option value="VBR">VBR</option>
          <option value="CQP">CQP</option>
        </select>
        <p class="form-help">CBR ensures constant bitrate. Use VBR or CQP only if needed.</p>
      </div>

      <div class="form-group">
        <label for="keyint_sec">Keyframe Interval (sec)</label>
        <input type="number" id="keyint_sec" name="keyint_sec" min="1" max="10" value="2">
        <p class="form-help">Use 2 for YouTube/Twitch compatibility.</p>
      </div>

      <div class="form-group">
        <label for="preset">Preset</label>
        <select id="preset" name="preset">
          <option value="ultrafast">ultrafast</option>
          <option value="superfast">superfast</option>
          <option value="veryfast">veryfast</option>
          <option value="faster">faster</option>
          <option value="fast">fast</option>
          <option value="medium">medium</option>
          <option value="slow">slow</option>
          <option value="slower">slower</option>
          <option value="veryslow">veryslow</option>
          <option value="p1">p1 (Max Performance)</option>
          <option value="p5" selected>p5 (Quality)</option>
        </select>
        <p class="form-help">Controls compression speed/quality tradeoff. p5 is good quality NVENC preset.</p>
      </div>

      <div class="form-group">
        <label for="profile">Profile</label>
        <select id="profile" name="profile">
          <option value="baseline">baseline</option>
          <option value="main">main</option>
          <option value="high" selected>high</option>
        </select>
        <p class="form-help">Use 'high' for most modern devices. 'baseline' for legacy support.</p>
      </div>

      <div class="form-group">
        <label for="gpu">GPU Index</label>
        <input type="number" id="gpu" name="gpu" min="0" value="0">
        <p class="form-help">Set GPU index. 0 for single-GPU systems.</p>
      </div>

      <div class="form-group">
        <label for="bf">Max B-frames</label>
        <input type="number" id="bf" name="bf" min="0" max="4" value="2">
        <p class="form-help">Improves compression at cost of latency. Recommended: 2.</p>
      </div>

      <div class="form-group">
        <label for="lookahead">Lookahead</label>
        <select id="lookahead" name="lookahead">
          <option value="true">Enabled</option>
          <option value="false" selected>Disabled</option>
        </select>
        <p class="form-help">Improves visual quality in motion-heavy scenes. Uses GPU resources.</p>
      </div>

      <div class="form-group">
        <label for="psycho_aq">Psycho Visual Tuning</label>
        <select id="psycho_aq" name="psycho_aq">
          <option value="true" selected>Enabled</option>
          <option value="false">Disabled</option>
        </select>
        <p class="form-help">Improves perceived visual quality. Recommended: Enabled.</p>
      </div>

      <div class="form-group text-right">
        <button type="submit" id="save-tweak-button">ðŸ’¾ Save RTMP Settings</button>
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="{{ url_for('static', filename='js/tweak.js') }}"></script>
{% endblock %}